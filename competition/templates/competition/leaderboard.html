{% extends "base.html" %}
{% block content %}
<section class="max-w-7xl mx-auto px-6 py-16">

  <!-- Title -->
  <div class="mb-12 text-center">
    <h2 class="text-5xl font-extrabold tracking-widest bg-gradient-to-r from-cyan-400 to-green-400 bg-clip-text text-transparent mb-3">
      LEADERBOARD
    </h2>
    <p class="text-gray-400 text-lg">
      Top performers of the Blind Typing Challenge
    </p>
  </div>

  <!-- Test Selector -->
  <div class="mb-10 flex justify-center">
    <div class="relative w-full max-w-md">
      <!-- Custom Arrow -->
      <div class="pointer-events-none absolute inset-y-0 right-4 flex items-center text-cyan-400">
        <i class="fa-solid fa-chevron-down"></i>
      </div>

      <select
        id="testSelector"
        class="w-full appearance-none bg-black/60 backdrop-blur border border-white/10 text-white px-5 py-3 pr-12 rounded-2xl text-lg font-semibold tracking-wide
               focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400
               hover:border-cyan-400/50 transition-all duration-200 shadow-lg">
        {% for test in tests %}
          <option value="test-{{ test.id }}" class="bg-slate-900 text-white">
            {{ test.title }}
          </option>
        {% endfor %}
      </select>
    </div>
  </div>

  {% if tests %}
    {% for test in tests %}
    <!-- ================= Test Section ================= -->
    <div class="mb-20 test-section hidden" id="test-{{ test.id }}">

      <!-- Test Title -->
      <h3 class="text-3xl font-bold text-cyan-300 mb-8">
        ðŸ§ª {{ test.title }}
      </h3>

      {% if test.ordered_results %}

      <!-- ===== Top 3 Podium ===== -->
      <div class="grid md:grid-cols-3 gap-6 mb-14">
        {% for r in test.ordered_results|slice:":3" %}
        <div class="relative bg-black/50 backdrop-blur border border-white/10 rounded-2xl p-6 text-center shadow-xl
                    {% if forloop.counter == 1 %} ring-2 ring-yellow-400
                    {% elif forloop.counter == 2 %} ring-2 ring-gray-300
                    {% elif forloop.counter == 3 %} ring-2 ring-orange-400
                    {% endif %}">

          <!-- Medal Icon -->
          <div class="absolute -top-4 left-1/2 -translate-x-1/2 text-3xl">
            {% if forloop.counter == 1 %}
              <i class="fa-solid fa-trophy text-yellow-400"></i>
            {% elif forloop.counter == 2 %}
              <i class="fa-solid fa-medal text-gray-300"></i>
            {% elif forloop.counter == 3 %}
              <i class="fa-solid fa-medal text-orange-400"></i>
            {% endif %}
          </div>

          <!-- Avatar -->
          <div class="mx-auto mb-4 h-16 w-16 rounded-full bg-gradient-to-r from-purple-500 to-green-400 flex items-center justify-center text-black text-2xl font-bold">
            {{ r.user.username|first|upper }}
          </div>

          <h3 class="text-xl font-bold text-white mb-1">
            {{ r.user.username }}
          </h3>

          <p class="text-sm text-gray-400 mb-4">
            Rank #{{ forloop.counter }}
          </p>

          <div class="flex justify-around text-sm">
            <div>
              <div class="text-lg font-bold text-green-400">
                <i class="fa-solid fa-gauge-high mr-1"></i> {{ r.wpm }}
              </div>
              <div class="text-gray-400">WPM</div>
            </div>
            <div>
              <div class="text-lg font-bold text-cyan-400">
                <i class="fa-solid fa-bullseye mr-1"></i> {{ r.accuracy|floatformat:"2" }}%
              </div>
              <div class="text-gray-400">Accuracy</div>
            </div>
          </div>

        </div>
        {% endfor %}
      </div>

      <!-- ===== Full Table ===== -->
      <div class="overflow-x-auto rounded-2xl border border-white/10 bg-black/40 backdrop-blur shadow-2xl">
        <table class="w-full text-left">
          <thead class="bg-gradient-to-r from-cyan-500/20 to-green-500/20 text-cyan-300 sticky top-0">
            <tr>
              <th class="px-6 py-4 font-semibold">Rank</th>
              <th class="px-6 py-4 font-semibold">User</th>
              <th class="px-6 py-4 font-semibold">WPM</th>
              <th class="px-6 py-4 font-semibold">Accuracy</th>
            </tr>
          </thead>

          <tbody class="divide-y divide-white/10">
            {% for r in test.ordered_results %}
            <tr class="hover:bg-white/5 transition">

              <td class="px-6 py-4 font-bold text-cyan-400">
                #{{ forloop.counter }}
              </td>

              <td class="px-6 py-4 flex items-center gap-3">
                <div class="h-10 w-10 rounded-full bg-gradient-to-r from-purple-500 to-green-400 flex items-center justify-center text-black font-bold">
                  {{ r.user.username|first|upper }}
                </div>
                <span class="font-semibold text-white">
                  {{ r.user.username }}
                </span>
              </td>

              <td class="px-6 py-4 font-semibold text-green-400">
                <i class="fa-solid fa-gauge-high mr-1"></i> {{ r.wpm }}
              </td>

              <td class="px-6 py-4 text-cyan-400">
                <i class="fa-solid fa-bullseye mr-1"></i> {{ r.accuracy|floatformat:"2" }}%
              </td>

            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      {% else %}
        <div class="text-gray-400 text-center py-10">
          No results for this test yet.
        </div>
      {% endif %}

    </div>
    <!-- ================= End Test Section ================= -->
    {% endfor %}
  {% else %}
    <div class="text-center text-gray-400 py-20">
      <i class="fa-solid fa-rocket mr-2"></i>
      No results available yet.
    </div>
  {% endif %}

</section>

<script>
  const selector = document.getElementById("testSelector");
  const sections = document.querySelectorAll(".test-section");

  function showSelectedTest() {
    const selectedId = selector.value;
    sections.forEach(section => {
      if (section.id === selectedId) {
        section.classList.remove("hidden");
      } else {
        section.classList.add("hidden");
      }
    });
  }

  if (sections.length > 0) {
    sections[0].classList.remove("hidden");
    selector.value = sections[0].id;
  }

  selector.addEventListener("change", showSelectedTest);
</script>

{% endblock %}